&emsp;&emsp;Backtrader是一个基于Python的量化回测框架。  
&emsp;&emsp;量化交易在回测时，需要有数据、策略、资金量、佣金、滑点以及回测指标等等；还要有一个将上述各部分有机组合起来的方法。  
&emsp;&emsp;在Backtrader中，有一个负责把各个功能模块有机组合起来的类：Cerebro。Cerebro有大脑的意思，和人的大脑类似，负责整体的组织协调。当实例化这个类后，就可以往里面添加数据、策略、回测指标等等；添加完成后，就可以运行，得到回测的结果。  
&emsp;&emsp;下面的代码是基于Backtrader的回测流程：
```python
import backtrader as bt 
import pandas as pd
# 创建策略类：双均线
class TwoSmaStrategy(bt.Strategy):
    params = (('short', 5), ('long', 10))
    def __init__(self):
        self.order = None #初始化订单
        self.sma_s = bt.indicators.MovingAverageSimple(self.datas[0].lines.close, period=self.params.short) #短期均线指标
        self.sma_l = bt.indicators.MovingAverageSimple(self.datas[0].lines.close, period=self.params.long) #长期均线指标
    
    # 策略方法
    def next(self):
      
        # 检查是否已经买入
        if not self.position:
            # 如果没有买入，并且短期均线 > 长期均线，说明涨势，买入
            if self.sma_s[0] > self.sma_l[0]:
                self.order = self.buy()
        else:
            # 已经买了，并且短期均线 < 长期均线，说明跌势，卖出
            if self.sma_s[0] < self.sma_l[0]:
                self.order = self.sell()

if __name__ == '__main__':
    cerebro = bt.Cerebro() #实例化cerebro对象
    
    #获取数据
    data_path = './data/sz.000961.csv'
    df = pd.read_csv(data_path)
    df['date'] = pd.to_datetime(df['date'])
    data = bt.feed.PandasData(dataname=df, datetime='date')
    
    cerebro.addstrategy(TwoSmaStrategy) #加载策略类到cerebro对象中
    cerebro.adddata(data) #加载数据对象到cerebro对象中
    cerebro.broker.setcash(10000000) #设置资金
    cerebro.broker.setcommission(0.0015) #设置佣金
    cerebro.broker.set_slippage_perc(0.01) #设置滑点
    cerebro.addanalyzer(bt.analyzers.SharpeRatio, _name='sharpe') #加载夏普率类到cerebro对象中
    
    ret = cerebro.run() #进行回测
    print(ret[0].analyzers.sharpe.get_analysis()) #输出策略的夏普率
    cerebro.plot() #画图
```
&emsp;&emsp;上述代码包含两部分，一部分是创建一个继承bt.Strategy的策略类TwoSmaStrategy，用于实现策略；另一部分是实现回测的具体流程。  
&emsp;&emsp;策略类TwoSmaStrategy实现了两个方法，一个是初始化方法__init__()，另一个是next()。初始化方法里完成了指标的计算，以及一些属性的初始化；next()方法里是策略的实现：在这里，根据算法逻辑，实现买入和卖出。  
&emsp;&emsp;在回测的流程里，第一步是要实例化Cerebro，得到对象cerebro；然后往对象里面添加数据对象、策略类、设置资金、设置佣金、设置滑点、添加回测指标，添加的顺序无关紧要；添加完成后，按下运行的按钮：cerebro.run()，对象cerebro自动运行，得到回测结果。  
